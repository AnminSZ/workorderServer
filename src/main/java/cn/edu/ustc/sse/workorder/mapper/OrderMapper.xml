<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.ustc.sse.workorder.mapper.OrderMapper">
    <resultMap id="BaseResultMap" type="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="number" jdbcType="VARCHAR" property="number"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="priority" jdbcType="INTEGER" property="priority"/>
        <result column="category" jdbcType="INTEGER" property="category"/>
        <result column="userID" jdbcType="INTEGER" property="userid"/>
        <result column="phone" jdbcType="VARCHAR" property="phone"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="attachment" jdbcType="VARCHAR" property="attachment"/>
        <result column="engineerID" jdbcType="INTEGER" property="engineerid"/>
        <result column="createTime" jdbcType="TIMESTAMP" property="createtime"/>
        <result column="finishTime" jdbcType="TIMESTAMP" property="finishtime"/>
    </resultMap>
    <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="content" jdbcType="LONGVARCHAR" property="content"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, number, title, status, priority, category, userID, phone, email, attachment,
        engineerID, createTime, finishTime
    </sql>

    <sql id="Blob_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        content
    </sql>

    <!--根据id查找工单全部信息-->
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from OrderInfo
        where id = #{id,jdbcType=INTEGER}
    </select>

    <select id="selectAllOrders" resultType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        select *
        from OrderInfo
    </select>

    <!--使用工单编号，创建时间，关键字查询工单-->
    <select id="selectByKeywords" parameterType="cn.edu.ustc.sse.workorder.bean.OrderInfoCustom"
            resultType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        select * from OrderInfo
        <where>
            <if test="userID!=null and userID!='' ">
                and userID = #{userID}
            </if>
            <if test="number!=null and number!='' ">
                and number = #{number}
            </if>
            <if test="startTime!=null  and endTime!=null  ">
                and createTime between #{startTime} and #{endTime}
            </if>
            <if test="keyword!=null and keyword!='' ">
                and (title like concat('%' , #{keyword} ,'%') or content like concat('%' , #{keyword} ,'%'))
            </if>
        </where>
    </select>

    <select id="selectByUserID" parameterType="java.lang.Integer" resultType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        select *
        from OrderInfo
        where userID = #{userID}
    </select>
    <!--根据id删除工单信息-->
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from OrderInfo
        where id = #{id,jdbcType=INTEGER}
    </delete>

    <!--插入一条工单信息-->
    <insert id="insert" parameterType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into OrderInfo (number, title,
        status, priority, category,
        userID, phone, email,
        attachment, engineerID, createTime,
        finishTime, content)
        values (#{number,jdbcType=VARCHAR}, #{title,jdbcType=VARCHAR},
        #{status,jdbcType=INTEGER}, #{priority,jdbcType=INTEGER}, #{category,jdbcType=INTEGER},
        #{userid,jdbcType=INTEGER}, #{phone,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
        #{attachment,jdbcType=VARCHAR}, #{engineerid,jdbcType=INTEGER}, #{createtime,jdbcType=TIMESTAMP},
        #{finishtime,jdbcType=TIMESTAMP}, #{content,jdbcType=LONGVARCHAR})
    </insert>

    <!--根据id更新一条工单的信息-->
    <update id="update" parameterType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update OrderInfo
        <set>
            <if test="number != null">
                number = #{number,jdbcType=VARCHAR},
            </if>
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="priority != null">
                priority = #{priority,jdbcType=INTEGER},
            </if>
            <if test="category != null">
                category = #{ategory,jdbcType=INTEGER},
            </if>
            <if test="userid != null">
                userID = #{userid,jdbcType=INTEGER},
            </if>
            <if test="phone != null">
                phone = #{phone,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="attachment != null">
                attachment = #{attachment,jdbcType=VARCHAR},
            </if>
            <if test="engineerid != null">
                engineerID = #{engineerid,jdbcType=INTEGER},
            </if>
            <if test="createtime != null">
                createTime = #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="finishtime != null">
                finishTime = #{finishtime,jdbcType=TIMESTAMP},
            </if>
            <if test="content != null">
                content = #{content,jdbcType=LONGVARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>

    <!--更新工单的状态  频繁操作  所以单独一个接口-->
    <update id="updateStatus" parameterType="cn.edu.ustc.sse.workorder.bean.OrderInfo">
        update OrderInfo set status=#{status,jdbcType=INTEGER} where id= #{id}
    </update>


</mapper>